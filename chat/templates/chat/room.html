{% extends 'chat/base.html' %}
{% block title %}Room {{ room_name }}{% endblock %}
{% block content %}
<h2>Room: {{ room_name }}</h2>

<div id="presence">Online: <span id="online-list"></span></div>

<div id="chat-window">
    <div id="messages" aria-live="polite">
        {% for m in messages %}
            <div class="message" data-id="{{ m.id }}">
                <b>{{ m.user.username }}</b> <small>{{ m.timestamp|date:"SHORT_DATETIME_FORMAT" }}</small><br>
                <span class="content">{{ m.content|linebreaks }}</span>
                {% if m.attachment %}
                    <div><a href="{{ m.attachment.url }}" target="_blank">Attachment</a></div>
                {% endif %}
                <div class="read-by">Read by: {% for u in m.read_by.all %}{{ u.username }} {% empty %}none{% endfor %}</div>
            </div>
        {% endfor %}
    </div>
    <button id="load-more" data-page="1">Load more</button>
</div>

<form id="chat-form">
    <input type="text" id="message-input" placeholder="Type a message...">
    <input type="file" id="file-input">
    <button type="submit">Send</button>
</form>
{% endblock %}

{% block scripts %}
<script src="{% static 'chat/js/chat.js' %}"></script>
<script>
const ROOM_NAME = "{{ room_name }}";
const CURRENT_USER = "{{ user.username }}";
const WS_PATH = (window.location.protocol === 'https:' ? 'wss' : 'ws') + '://' + window.location.host + '/ws/chat/' + ROOM_NAME + '/';
initChat(WS_PATH, ROOM_NAME, CURRENT_USER);
</script>
{% endblock %}
